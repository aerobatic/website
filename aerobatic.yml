id: f593b673-75f2-4c7e-8a65-6e0d7a6e0f05
deploy:
  ignore: []
  directory: public
  alerts:
    default:
      slack:
        webhookUrl: $SLACK_WEBHOOK_ALERT
      email:
        to: [david.vonlehman@gmail.com]
plugins:
  - name: http-proxy
    path: /slack
    method: post
    options:
      url: $SLACK_WEBHOOK
  - name: cors
    path: /github-api/*
    options:
       origin:
        - https://www.aerobatic.com
        - http://localhost:1313
  - name: http-proxy
    path: /github-api/*
    method: get
    options:
      url: https://api.github.com/*
      # Cache on CDN for 1 hour
      cacheMaxAge: 3600
      headers:
        # new Buffer('dvonlehman:{PERSONAL_TOKEN}').toString('base64')
        Authorization: Basic $GITHUB_API_AUTH
  - name: http-proxy
    path: /github-raw/*
    method: get
    options:
      url: https://raw.githubusercontent.com/*
      cacheMaxAge: 86400

  - name: s3-proxy
    path: /media
    options:
      bucket: aerobatic-media
      prefix: website
      region: us-west-2
      overrideCacheControl: max-age=2592000
      accessKeyId: $S3_ACCESS_KEY_ID
      secretAccessKey: $S3_SECRET_ACCESS_KEY
  - name: keyword-search
    path: /search
    method: get
    options:
      resultsTemplate: /search/index.html
      mustacheTags: ['<%=', '%>']
  - name: redirect
    options:
      /docs: /docs/getting-started/
      /docs/environment-variables: '/docs/configuration/#environment-variables'
      /docs/api-proxy: /docs/plugins/http-proxy/
      /docs/performance: '/docs/overview/#performance'
      /docs/ssl: /docs/custom-domains-ssl/
      /docs/custom-domains: /docs/custom-domains-ssl/
      /docs/automated-builds: /docs/static-generators/
      /docs/http-proxy: /docs/plugins/http-proxy/
      /docs/s3-proxy: /docs/plugins/s3-proxy/
      /docs/cors: /docs/plugins/cors/
      /docs/redirects: /docs/plugins/redirect/
      /docs/http-basic-authentication: /docs/plugins/basic-auth/
      /docs/custom-error-pages: /docs/plugins/custom-errors/
      /docs/static-http-hosting: /docs/static-serving/
      /bitbucket-changes: /blog/announcing-aerobatic-transition/
      /feed.xml: /index.xml
      /themes/: /themes/html5/
  - name: health-check
    path: /health
  - name: custom-errors
    options:
      errors:
        '404': 404.html

scanner:
  keywordSearch:
    noIndexPatterns:
      - /tags/**
      - /legal/**
      - /search/**
    titleStripStart: "Aerobatic - "

